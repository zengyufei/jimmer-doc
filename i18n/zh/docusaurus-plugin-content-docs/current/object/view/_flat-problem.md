:::caution
本文内容仅针对Output DTO，Input DTO可以随意采用flat方案。
:::

对于Output而言，`flat`模式是争议性话题。笔者对此持反对意见，因为

-   关联模型并不复杂，并不值得系统为此提供补必要的转化逻辑

-   这会让后端系统和特定的UI前端严重绑定，丧失了本应具备的普适性 *(这非常重要，后面会重点讨论)*

更深层次原因：原生带有关联关系的数据结构是规范化数据，而经过`flat`处理后的的扁平对象是非关联数据。

然而，你很可能处在这样一种工作状态：和你对接的前端团队要求所有查询API一律返回扁平对象，要求除了集合属性以外的任何属性都必须经过`flat`处理，并且非常坚持。

现在解释为什么部分前端团队会有这种坚持。UI项目可以认为两种：

-   不需要状态管理的项目

    这类项目最大特色是界面上的功能区 *(排除顶栏和侧栏等非功能区)* 采用整体切换模式 *(以手机为代码的小屏幕设备更容易导致这种情况)*，因此，每个UI界面都是数据孤岛。

    此时，项目的主要复杂度在于UI绘制。前端开发人员无需关注数据模型，完全不在乎。
    
    既然不在乎，最自然的想法就是期望数据结构和界面结构完全一样。对于非集合关联而言，UI通常平坦展示，所以产生了所有API都要返回平坦对象的诉求。

-   需要状态管理的项目

    这类项目最大特色是界面上的功能区存在分散、并存和复杂协同问题，因此，不同UI组件之间存在千丝万缕的联系。

    此时，项目的主要复杂度在于状态管理，前端开发人员必须高度关注数据模型的结构。

    前端状态管理，在从某种程度上讲，就是数据的规范化甚至关系化，大量的`flat`数据对这种项目具有破坏性。

如果前端团队从来没有经历过需要状态管理的UI项目，当然就无法意识到规范化数据的重要性。这时，就会形成对flat结构习惯性依赖，并拒绝接受看起来有违自己认知但其实没有什么成本的其他概念。

前面提到大量使用`flat`模式会让后端系统和特定的UI前端严重绑定，让我来思考一个场景。

1.  首先推出了手机UI。这个UI应用很简单，每个页面都是数据孤岛，无需状态管理。因此，大量的后端API设计成了`flat`风格。

2.  随着系统越来也复杂，只有面向用户的手机应用是不够的，需要增加内部人员使用的管理系统。如果这个系统的UI逻辑比较复杂，最终被判定成了需要状态管理的UI项目，那么`flat`风格的后端API将会非常难以处理。要么后端再开发一套新的返回规范化数据API，要么前端编写大量代码把数据再度恢复成规范化的。

可以通过讨论来说服，表明规范化数据对状态管理的重要性，表明规范化数据对很多UI库而言不是问题，例如，[Antd中Table.Column](https://ant.design/components/table#column)的`dataIndex`属性的类型是`string | string[]`，其中，`string[]`就是对层次化数据的支持，不会导致开发遇到任何问题。

如果你所处角色对此没有话语权或无法说服对方，那么就可以使用`flat`函数来处理。
