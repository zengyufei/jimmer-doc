"use strict";(self.webpackChunkdocusaurus_code=self.webpackChunkdocusaurus_code||[]).push([[6559],{82134:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>b,frontMatter:()=>o,metadata:()=>a,toc:()=>u});const a=JSON.parse('{"id":"showcase/where/dynamic-join","title":"4.4 Dynamic Table Join","description":"Usage","source":"@site/docs/showcase/where/dynamic-join.mdx","sourceDirName":"showcase/where","slug":"/showcase/where/dynamic-join","permalink":"/jimmer-doc/docs/showcase/where/dynamic-join","draft":false,"unlisted":false,"editUrl":"https://github.com/babyfish-ct/jimmer-doc/edit/main/docs/showcase/where/dynamic-join.mdx","tags":[],"version":"current","lastUpdatedAt":1714914925000,"sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"4.4 Dynamic Table Join"},"sidebar":"tutorialSidebar","previous":{"title":"4.3 Associated Id","permalink":"/jimmer-doc/docs/showcase/where/associated-id"},"next":{"title":"4.5 Implicit Subquery","permalink":"/jimmer-doc/docs/showcase/where/implicit-subquery"}}');var l=t(74848),s=t(28453),r=t(11470),i=t(19365);const o={sidebar_position:4,title:"4.4 Dynamic Table Join"},c=void 0,d={},u=[{value:"Usage",id:"usage",level:2},{value:"Various Situations",id:"various-situations",level:2},{value:"All table joins do not take effect",id:"all-table-joins-do-not-take-effect",level:3},{value:"Some table joins take effect",id:"some-table-joins-take-effect",level:3},{value:"All table joins take effect",id:"all-table-joins-take-effect",level:3},{value:"IsNull\u548c\u5916\u8fde\u63a5",id:"isnull\u548c\u5916\u8fde\u63a5",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",mdxAdmonitionTitle:"mdxAdmonitionTitle",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,l.jsxs)(r.A,{groupId:"language",children:[(0,l.jsx)(i.A,{value:"java",label:"Java",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:"@Nullable String storeName = ...Omitted...;\n@Nullable String storeWebsite = ...Omitted...;\n\nBookTable table = BookTable.$;\nList<Book> books = sqlClient\n    .createQuery(table)\n    .where(table.store().name().eqIf(storeName)) \u2776\n    .where(table.store().website().eqIf(storeWebsite)) \u2777\n    .select(table)\n    .execute();\n"})})}),(0,l.jsx)(i.A,{value:"kotlin",label:"Kotlin",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-kotlin",children:"val storeName: String? = ...Omitted...\nval storeWebsite: String? = ...Omitted...\n\nval books = sqlClient\n    .createQuery(Book::class) {\n        where(table.store.name `eq?` storeName) \u2776\n        where(table.store.website `eq?` storeWebsite) \u2777\n        select(table)\n    }\n    .execute()\n"})})})]}),"\n",(0,l.jsxs)(n.admonition,{type:"info",children:[(0,l.jsx)(n.mdxAdmonitionTitle,{}),(0,l.jsxs)(n.p,{children:["In the above code, Java's ",(0,l.jsx)(n.code,{children:"table.store()"})," and Kotlin's ",(0,l.jsx)(n.code,{children:"table.store"})," represent the inner join between the table defined by ",(0,l.jsx)(n.code,{children:"Book"})," and the table defined by ",(0,l.jsx)(n.code,{children:"BookStore"})," through the many-to-one association ",(0,l.jsx)(n.code,{children:"Book.store"}),"."]}),(0,l.jsx)(n.p,{children:"That is, the following SQL logic is represented:"}),(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"from BOOK b inner join BOOK_STORE s on b.STORE_ID = s.ID\n"})}),(0,l.jsxs)(n.p,{children:["In fact, if the entity model is richer, longer paths can be written, such as ",(0,l.jsx)(n.code,{children:"table.store().city().province()"}),"."]}),(0,l.jsxs)(n.p,{children:["Here, just for quick start guide and preview, it is unnecessary to build a richer entity model to demonstrate longer paths. The shortest table chain join path ",(0,l.jsx)(n.code,{children:"table.store()"})," is enough."]})]}),"\n",(0,l.jsx)(n.h2,{id:"various-situations",children:"Various Situations"}),"\n",(0,l.jsx)(n.h3,{id:"all-table-joins-do-not-take-effect",children:"All table joins do not take effect"}),"\n",(0,l.jsxs)(n.p,{children:["If both ",(0,l.jsx)(n.code,{children:"storeName"})," and ",(0,l.jsx)(n.code,{children:"storeWebsite"})," are null, it will cause the dynamic table joins created at \u2776 and \u2777 to be unused. Unused table joins will be automatically ignored without rendering any actual SQL joins."]}),"\n",(0,l.jsx)(n.p,{children:"At this time, the following SQL is generated:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"select\n    tb_1_.ID,\n    tb_1_.NAME,\n    tb_1_.EDITION,\n    tb_1_.PRICE,\n    tb_1_.STORE_ID\nfrom BOOK tb_1_\n"})}),"\n",(0,l.jsx)(n.h3,{id:"some-table-joins-take-effect",children:"Some table joins take effect"}),"\n",(0,l.jsxs)(n.p,{children:["If ",(0,l.jsx)(n.code,{children:"storeName"})," is specified as non-null while ",(0,l.jsx)(n.code,{children:"storeWebsite"})," remains null, the dynamic table join at \u2776 takes effect, while the dynamic table join at \u2777 is ignored."]}),"\n",(0,l.jsx)(n.p,{children:"At this time, the following SQL is generated:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"select\n    tb_1_.ID,\n    tb_1_.NAME,\n    tb_1_.EDITION,\n    tb_1_.PRICE,\n    tb_1_.STORE_ID\nfrom BOOK tb_1_\ninner join BOOK_STORE tb_2_\n    on tb_1_.STORE_ID = tb_2_.ID\nwhere\n    tb_2_.NAME = ? /* MANNING */\n"})}),"\n",(0,l.jsx)(n.h3,{id:"all-table-joins-take-effect",children:"All table joins take effect"}),"\n",(0,l.jsxs)(n.p,{children:["If both ",(0,l.jsx)(n.code,{children:"storeName"})," and ",(0,l.jsx)(n.code,{children:"storeWebsite"})," are specified as non-null, the dynamic table joins created at \u2776 and \u2777 will both take effect."]}),"\n",(0,l.jsxs)(n.admonition,{type:"tip",children:[(0,l.jsx)(n.mdxAdmonitionTitle,{}),(0,l.jsx)(n.p,{children:"Jimmer can automatically merge conflicting table joins. The two joins will be merged into one.\nUltimately, only one SQL join will be rendered"})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"select\n    tb_1_.ID,\n    tb_1_.NAME,\n    tb_1_.EDITION,\n    tb_1_.PRICE,\n    tb_1_.STORE_ID\nfrom BOOK tb_1_\ninner join BOOK_STORE tb_2_\n    on tb_1_.STORE_ID = tb_2_.ID\nwhere\n        tb_2_.NAME = ? /* MANNING */\n    and\n        tb_2_.WEBSITE = ? /* https://www.manning.com */\n"})}),"\n",(0,l.jsx)(n.h2,{id:"isnull\u548c\u5916\u8fde\u63a5",children:"IsNull\u548c\u5916\u8fde\u63a5"}),"\n",(0,l.jsxs)(n.p,{children:["\u7c7b\u4f3cJava\u4e2d",(0,l.jsx)(n.code,{children:"table.store()"}),"\u6216Kotlin",(0,l.jsx)(n.code,{children:"table.store"}),"\u8fd9\u6837\u7684\u8fde\u63a5\u8def\u5f84\uff0c\u4f1a\u88ab\u6e32\u67d3\u6210SQL\u7684\u5185\u8fde\u63a5\uff0c\u800c\u975e\u5916\u8fde\u63a5\uff0c\u8fd9\u662f\u56e0\u4e3a"]}),"\n",(0,l.jsx)(n.admonition,{type:"info",children:(0,l.jsx)(n.p,{children:"\u5185\u8fde\u63a5\u6bd4\u5916\u8fde\u63a5\u62e5\u6709\u66f4\u597d\u7684\u6027\u80fd\uff01"})}),"\n",(0,l.jsxs)(n.admonition,{type:"caution",children:[(0,l.jsxs)(n.p,{children:["\u4e3a\u6b64\uff0cJimmer\u4e0d\u60dc\u901a\u8fc7\u5f02\u5e38\u8ba9\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5185\u8fde\u63a5\u800c\u5f97\u5230\u7684\u8868\u5bf9\u8c61\u4e0d\u652f\u6301",(0,l.jsx)(n.code,{children:"isNull"}),"\u3002"]}),(0,l.jsxs)(n.p,{children:["\u5982\u679c\u8981\u5bf9\u5173\u8054\u5bf9\u8c61\u65bd\u52a0",(0,l.jsx)(n.code,{children:"isNull"}),"\uff0c\u5fc5\u987b\u660e\u786e\u91c7\u7528\u5916\u8fde\u63a5\u64cd\u4f5c\uff0c\u4f8b\u5982"]})]}),"\n",(0,l.jsxs)(r.A,{groupId:"language",children:[(0,l.jsx)(i.A,{value:"java",label:"Java",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:"TreeNodeTable table = TreeNodeTable.$;\nList<TreeNode> rootNodes = sqlClient\n    .createQuery(table)\n    // highlight-next-line\n    .where(table.parent(JoinType.LEFT).isNull())\n    .select(table)\n    .execute();\n"})})}),(0,l.jsx)(i.A,{value:"kotlin",label:"Kotlin",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-kotlin",children:"val rootNodes = sqlClient\n    .createQuery(TreeNode::class) {\n        // highlight-next-line\n        where(table.`parent?`.isNull())\n        select(table)\n    }\n    .execute()\n"})})})]}),"\n",(0,l.jsxs)(n.p,{children:["Java\u4ee3\u7801\u4e2d\u7684",(0,l.jsx)(n.code,{children:".parent(JoinType.LEFT)"}),"\u548cKotlin\u4ee3\u7801\u4e2d\u7684",(0,l.jsx)(n.code,{children:".parent?"}),"\u8868\u793a\u5de6\u8fde\u63a5\u3002"]}),"\n",(0,l.jsxs)(n.p,{children:["\u5176\u5b9e\uff0c\u8fd9\u79cd\u6848\u4f8b\u66f4\u9002\u5408",(0,l.jsx)(n.a,{href:"./associated-id",children:"\u4e0a\u4e00\u6587"}),"\u4e2d\u7684\u5173\u8054id\u6761\u4ef6"]}),"\n",(0,l.jsxs)(r.A,{groupId:"language",children:[(0,l.jsx)(i.A,{value:"java",label:"Java",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:"TreeNodeTable table = TreeNodeTable.$;\nList<TreeNode> rootNodes = sqlClient\n    .createQuery(table)\n    // highlight-next-line\n    .where(table.parentId().isNull())\n    .select(table)\n    .execute();\n"})})}),(0,l.jsx)(i.A,{value:"kotlin",label:"Kotlin",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-kotlin",children:"val rootNodes = sqlClient\n    .createQuery(TreeNode::class) {\n        // highlight-next-line\n        where(table.parentId.isNull())\n        select(table)\n    }\n    .execute()\n"})})})]})]})}function b(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(h,{...e})}):h(e)}},19365:(e,n,t)=>{t.d(n,{A:()=>r});t(96540);var a=t(18215);const l={tabItem:"tabItem_Ymn6"};var s=t(74848);function r(e){let{children:n,hidden:t,className:r}=e;return(0,s.jsx)("div",{role:"tabpanel",className:(0,a.A)(l.tabItem,r),hidden:t,children:n})}},11470:(e,n,t)=>{t.d(n,{A:()=>w});var a=t(96540),l=t(18215),s=t(23104),r=t(56347),i=t(205),o=t(57485),c=t(31682),d=t(70679);function u(e){return a.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:n,children:t}=e;return(0,a.useMemo)((()=>{const e=n??function(e){return u(e).map((e=>{let{props:{value:n,label:t,attributes:a,default:l}}=e;return{value:n,label:t,attributes:a,default:l}}))}(t);return function(e){const n=(0,c.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function b(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function m(e){let{queryString:n=!1,groupId:t}=e;const l=(0,r.W6)(),s=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:n,groupId:t});return[(0,o.aZ)(s),(0,a.useCallback)((e=>{if(!s)return;const n=new URLSearchParams(l.location.search);n.set(s,e),l.replace({...l.location,search:n.toString()})}),[s,l])]}function j(e){const{defaultValue:n,queryString:t=!1,groupId:l}=e,s=h(e),[r,o]=(0,a.useState)((()=>function(e){let{defaultValue:n,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!b({value:n,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const a=t.find((e=>e.default))??t[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:n,tabValues:s}))),[c,u]=m({queryString:t,groupId:l}),[j,p]=function(e){let{groupId:n}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(n),[l,s]=(0,d.Dv)(t);return[l,(0,a.useCallback)((e=>{t&&s.set(e)}),[t,s])]}({groupId:l}),f=(()=>{const e=c??j;return b({value:e,tabValues:s})?e:null})();(0,i.A)((()=>{f&&o(f)}),[f]);return{selectedValue:r,selectValue:(0,a.useCallback)((e=>{if(!b({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);o(e),u(e),p(e)}),[u,p,s]),tabValues:s}}var p=t(92303);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var x=t(74848);function g(e){let{className:n,block:t,selectedValue:a,selectValue:r,tabValues:i}=e;const o=[],{blockElementScrollPositionUntilNextRender:c}=(0,s.a_)(),d=e=>{const n=e.currentTarget,t=o.indexOf(n),l=i[t].value;l!==a&&(c(n),r(l))},u=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const t=o.indexOf(e.currentTarget)+1;n=o[t]??o[0];break}case"ArrowLeft":{const t=o.indexOf(e.currentTarget)-1;n=o[t]??o[o.length-1];break}}n?.focus()};return(0,x.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.A)("tabs",{"tabs--block":t},n),children:i.map((e=>{let{value:n,label:t,attributes:s}=e;return(0,x.jsx)("li",{role:"tab",tabIndex:a===n?0:-1,"aria-selected":a===n,ref:e=>o.push(e),onKeyDown:u,onClick:d,...s,className:(0,l.A)("tabs__item",f.tabItem,s?.className,{"tabs__item--active":a===n}),children:t??n},n)}))})}function v(e){let{lazy:n,children:t,selectedValue:s}=e;const r=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=r.find((e=>e.props.value===s));return e?(0,a.cloneElement)(e,{className:(0,l.A)("margin-top--md",e.props.className)}):null}return(0,x.jsx)("div",{className:"margin-top--md",children:r.map(((e,n)=>(0,a.cloneElement)(e,{key:n,hidden:e.props.value!==s})))})}function _(e){const n=j(e);return(0,x.jsxs)("div",{className:(0,l.A)("tabs-container",f.tabList),children:[(0,x.jsx)(g,{...n,...e}),(0,x.jsx)(v,{...n,...e})]})}function w(e){const n=(0,p.A)();return(0,x.jsx)(_,{...e,children:u(e.children)},String(n))}},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>i});var a=t(96540);const l={},s=a.createContext(l);function r(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);