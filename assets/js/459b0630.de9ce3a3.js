"use strict";(self.webpackChunkdocusaurus_code=self.webpackChunkdocusaurus_code||[]).push([[6892],{93235:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>u,contentTitle:()=>d,default:()=>p,frontMatter:()=>c,metadata:()=>t,toc:()=>h});const t=JSON.parse('{"id":"quick-view/save/export/long","title":"Save Long Associations","description":"What is Long Association","source":"@site/docs/quick-view/save/export/long.mdx","sourceDirName":"quick-view/save/export","slug":"/quick-view/save/export/long","permalink":"/jimmer-doc/docs/quick-view/save/export/long","draft":false,"unlisted":false,"editUrl":"https://github.com/babyfish-ct/jimmer-doc/edit/main/docs/quick-view/save/export/long.mdx","tags":[],"version":"current","lastUpdatedAt":1708668447000,"sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Save Long Associations"},"sidebar":"tutorialSidebar","previous":{"title":"Save Short Associations","permalink":"/jimmer-doc/docs/quick-view/save/export/short"},"next":{"title":"3. Arbitrary Dynamic Query","permalink":"/jimmer-doc/docs/quick-view/dsl/"}}');var o=i(74848),r=i(28453),s=i(11470),a=i(19365),l=i(46845);const c={sidebar_position:3,title:"Save Long Associations"},d=void 0,u={},h=[{value:"What is Long Association",id:"what-is-long-association",level:2},{value:"Write DTO",id:"write-dto",level:2},{value:"Generated Code",id:"generated-code",level:2},{value:"Write HTTP Service",id:"write-http-service",level:2}];function m(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{id:"what-is-long-association",children:"What is Long Association"}),"\n",(0,o.jsx)(n.p,{children:"A long association refers to not only changing the association relationship between the current object and other objects, but also further modifying the associated object."}),"\n",(0,o.jsx)(n.p,{children:"For the UI interface, it is usually manifested as nested parent-child forms (or even recursive trees). The forms are diverse, and sub-forms embedded in forms are quite common, as follows:"}),"\n",(0,o.jsx)(l.Y,{}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsx)(n.p,{children:"As long as developers are willing, the depth of this nested parent-child form structure can be more than two layers. In theory, the depth can be infinite, which is why it is called a long association."})}),"\n",(0,o.jsx)(n.h2,{id:"write-dto",children:"Write DTO"}),"\n",(0,o.jsxs)(n.p,{children:["In the current example in the ",(0,o.jsx)(n.a,{href:"../../precondition#book",children:"entity definition"}),", the more suitable example as a long association to save is the ",(0,o.jsx)(n.code,{children:"BookStore"})," and its associated ",(0,o.jsx)(n.code,{children:"books"})," collection."]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Install DTO language Intellij plugin: ",(0,o.jsx)(n.a,{href:"https://github.com/ClearPlume/jimmer-dto",children:"https://github.com/ClearPlume/jimmer-dto"})," ",(0,o.jsx)(n.em,{children:"(This process is not required but highly recommended)"})]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Create a new directory ",(0,o.jsx)(n.code,{children:"src/main/dto"})]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Under ",(0,o.jsx)(n.code,{children:"src/main/dto"}),", create a file ",(0,o.jsx)(n.code,{children:"BookStore.dto"})," and write the following code:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",metastring:'title="BookStore.dto"',children:"export org.doc.j.model.BookStore  \n    -> package org.doc.j.model.dto  \n\ninput BookStoreWithLongAssociation {\n    #allScalars(this) \n    #highlight-next-line \n    books { // LongAssociation\n        #allScalars(this)\n        -id\n        id(authors) as authorIds \n    }\n}\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"generated-code",children:"Generated Code"}),"\n",(0,o.jsx)(n.p,{children:"After compilation, Jimmer will generate the following code:"}),"\n",(0,o.jsxs)(s.A,{groupId:"language",children:[(0,o.jsx)(a.A,{value:"java",label:"Java",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-java",metastring:'title="BookStoreWithLongAssociation.java"  ',children:'@GeneratedBy(\n        file = "<yourproject>/src/main/dto/BookStore.dto"  \n)\npublic class BookStoreWithLongAssociation implements Input<BookStore> {\n\n    @Nullable\n    private Long id;\n\n    @NotNull\n    private String name;   \n\n    @Nullable\n    private String website;\n\n    @NotNull\n    // highlight-next-line\n    private List<TargetOf_books> books;  \n\n    ...Omit other methods...\n\n    public static class TargetOf_books implements Input<Book> {  \n\n        @NotNull \n        private String name;\n\n        private int edition;\n\n        @NotNull\n        private BigDecimal price;\n\n        @NotNull\n        private List<Long> authorIds;\n\n        ...Omit other methods...\n    }  \n}\n'})})}),(0,o.jsx)(a.A,{value:"kotlin",label:"Kotlin",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-kotlin",metastring:'title="BookStoreWithLongAssociation.kt" ',children:'@GeneratedBy(\n        file = "<yourproject>/src/main/dto/BookStore.dto"  \n)\ndata class BookStoreWithLongAssociation(  \n    val id: Long?\n    val name: String,\n    val website: String?,\n    // highlight-next-line\n    val books: List<TargetOf_books>  \n) : Input<BookStore> {\n    \n    ...Omit other methods...  \n\n    data class TargetOf_authors(  \n        val name: String,\n        val edition: Int, \n        val price: BigDecimal, \n        val authorIds: List<Long>\n    )  \n}\n'})})})]}),"\n",(0,o.jsx)(n.h2,{id:"write-http-service",children:"Write HTTP Service"}),"\n",(0,o.jsxs)(s.A,{groupId:"language",children:[(0,o.jsx)(a.A,{value:"java",label:"Java",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-java",metastring:'title="BookStoreController.java"',children:'@RestController  \npublic class BookStoreController {  \n\n    private final JSqlClient sqlClient;\n\n    public BookController(JSqlClient sqlClient) {\n        this.sqlClient = sqlClient; \n    }  \n\n    @PutMapping("/bookStore")\n    public int saveBookStoreWithLongAssociation(\n        // highlight-next-line\n        @RequestBody BookStoreWithLongAssociation input\n    ) {\n        return sqlClient\n            .save(input)\n            .getTotalAffectedRowCount();\n    }\n}\n'})})}),(0,o.jsx)(a.A,{value:"kotlin",label:"Kotlin",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-kotlin",metastring:'title="BookStoreController.java" ',children:'class BookStoreController(\n    private val sqlClient: KSqlClient   \n) {  \n\n    @PutMapping("/bookStore")  \n    fun saveBookStoreWithLongAssociation(\n        // highlight-next-line\n        @RequestBody input: BookStoreWithLongAssociation  \n    ): Int =\n        sqlClient\n            .save(input)\n            .totalAffectedRowCount\n}\n'})})})]}),"\n",(0,o.jsx)(n.p,{children:"It can be seen that no matter how the Input DTO changes, Jimmer still only needs one method call to complete data saving."})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(m,{...e})}):m(e)}},42032:(e,n,i)=>{Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"default",{enumerable:!0,get:function(){return t.createSvgIcon}});var t=i(20690)},20690:(e,n,i)=>{i.r(n),i.d(n,{capitalize:()=>o.A,createChainedFunction:()=>r,createSvgIcon:()=>s.A,debounce:()=>a.A,deprecatedPropType:()=>l,isMuiElement:()=>c.A,ownerDocument:()=>d.A,ownerWindow:()=>u.A,requirePropFactory:()=>h,setRef:()=>m,unstable_ClassNameGenerator:()=>k,unstable_useEnhancedEffect:()=>p.A,unstable_useId:()=>g,unsupportedProp:()=>x,useControlled:()=>v.A,useEventCallback:()=>j.A,useForkRef:()=>A.A,useIsFocusVisible:()=>f.A});var t=i(12067),o=i(28466);const r=i(9941).A;var s=i(30332),a=i(1935);const l=function(e,n){return()=>null};var c=i(94346),d=i(96248),u=i(93749);i(58168);const h=function(e,n){return()=>null};const m=i(13721).A;var p=i(2778);const g=i(14953).A;const x=function(e,n,i,t,o){return null};var v=i(78478),j=i(83034),A=i(96852),f=i(90638);const k={configure:e=>{t.A.configure(e)}}},46845:(e,n,i)=>{i.d(n,{Y:()=>_});var t=i(96540),o=i(67733),r=i(67512),s=i(43581),a=i(80421),l=i(1489),c=i(71543),d=i(57416),u=i(53881),h=i(88933),m=i(46780),p=i(19591),g=i(618),x=i(73231),v=i(30854),j=i(16718),A=i(4671),f=i(67034),k=i(63051),b=i(15993),y=i(28968),C=i(13407),S=i(46831),w=i(44586),I=i(82470),B=i(16712),N=i(74848);const _=(0,t.memo)((()=>{const{i18n:e}=(0,w.A)(),n=(0,B.o)(),i=(0,t.useMemo)((()=>n?q:L),[n]),_=(0,t.useMemo)((()=>{const e=new Map;for(const n of i)e.set(n.id,n);return e}),[i]),M=(0,t.useMemo)((()=>n?P:T),[n]),z=(0,t.useMemo)((()=>{const e=new Map;for(const n of M)e.set(n.id,n);return e}),[M]),[O,D]=(0,I.e)((()=>({userId:1,province:_.get(1).province,city:_.get(1).city,address:_.get(1).address,items:[{__rowId:1,productId:1,name:z.get(1).name,quantity:2},{__rowId:2,productId:10,name:z.get(10).name,quantity:1}]}))),F=(0,t.useMemo)((()=>Math.max(...O.items.map((e=>e.__rowId)))+1),[O]),R=(0,t.useCallback)((e=>{const n=_.get(parseInt(e.target.value));void 0!==n&&D((e=>{e.userId=n.id,e.province=n.province,e.city=n.city,e.address=n.address}))}),[D,_]),G=(0,t.useCallback)((e=>{D((n=>{n.province=e.target.value}))}),[D]),J=(0,t.useCallback)((e=>{D((n=>{n.city=e.target.value}))}),[D]),U=(0,t.useCallback)((e=>{D((n=>{n.address=e.target.value}))}),[D]),E=(0,t.useCallback)(((e,n)=>{D((i=>{for(const t of i.items)if(t.__rowId===n){t.productId=parseInt(e.target.value),W(i);break}}))}),[D]),K=(0,t.useCallback)(((e,n)=>{D((i=>{for(const t of i.items)if(t.__rowId===n){t.quantity=parseInt(e.target.value),W(i);break}}))}),[D]),V=(0,t.useCallback)((e=>{D((n=>{for(let i=n.items.length-1;i>=0;--i)if(n.items[i].__rowId===e){n.items.splice(i,1);break}}))}),[D]),Q=(0,t.useCallback)((()=>{D((e=>{e.items.push({__rowId:F,quantity:1})}))}),[D,F]),[H,X]=(0,t.useState)(!1),Y=(0,t.useCallback)((()=>{X(!0)}),[]),Z=(0,t.useCallback)((()=>{X(!1)}),[]);return(0,N.jsxs)(d.A,{elevation:3,style:{padding:"1.5rem"},children:[(0,N.jsx)(o.A,{component:"form",noValidate:!0,autoComplete:"off",children:(0,N.jsxs)(l.Ay,{container:!0,spacing:2,children:[(0,N.jsx)(l.Ay,{item:!0,xs:4,children:(0,N.jsx)(s.A,{fullWidth:!0,select:!0,label:n?"\u8d2d\u4e70\u4eba":"Purchaser",value:O.userId,onChange:R,children:i.map((e=>(0,N.jsx)(a.A,{value:e.id,children:e.nickName},e.id)))})}),(0,N.jsx)(l.Ay,{item:!0,xs:4,children:(0,N.jsx)(s.A,{fullWidth:!0,label:n?"\u7701\u4efd":"Province",value:O.province,onChange:G})}),(0,N.jsx)(l.Ay,{item:!0,xs:4,children:(0,N.jsx)(s.A,{fullWidth:!0,label:n?"\u57ce\u5e02":"City",value:O.city,onChange:J})}),(0,N.jsx)(l.Ay,{item:!0,xs:12,children:(0,N.jsx)(s.A,{fullWidth:!0,label:n?"\u5730\u5740":"Address",value:O.address,onChange:U})}),(0,N.jsxs)(l.Ay,{item:!0,xs:12,children:[(0,N.jsx)(c.A,{textAlign:"left",children:n?"\u8ba2\u5355\u660e\u7ec6":"Order Items"}),(0,N.jsx)(p.A,{component:d.A,children:(0,N.jsxs)(u.A,{size:"small",children:[(0,N.jsx)(g.A,{children:(0,N.jsxs)(x.A,{children:[(0,N.jsx)(m.A,{children:n?"\u5546\u54c1":"Commodity"}),(0,N.jsx)(m.A,{children:n?"\u6570\u91cf":"Quantity"}),(0,N.jsx)(m.A,{children:n?"\u5355\u4ef7":"Unit price"}),(0,N.jsx)(m.A,{children:n?"\u660e\u7ec6\u4ef7":"Item price"}),(0,N.jsx)(m.A,{children:n?"\u5220\u9664":"Delete"})]})}),(0,N.jsx)(h.A,{children:O.items.map((e=>{const n=void 0!==e.productId?z.get(e.productId):void 0;return(0,N.jsxs)(x.A,{children:[(0,N.jsx)(m.A,{children:(0,N.jsx)(s.A,{select:!0,value:n?.id,variant:"standard",size:"small",onChange:n=>{E(n,e.__rowId)},children:M.map((e=>(0,N.jsx)(a.A,{value:e.id,children:e.name},e.id)))})}),(0,N.jsx)(m.A,{children:(0,N.jsx)(s.A,{type:"number",value:e.quantity,variant:"standard",size:"small",onChange:n=>{K(n,e.__rowId)}})}),(0,N.jsx)(m.A,{children:n?.price}),(0,N.jsx)(m.A,{children:void 0!==n&&n.price*e.quantity}),(0,N.jsx)(m.A,{children:(0,N.jsx)(A.A,{onClick:()=>V(e.__rowId),children:(0,N.jsx)(f.A,{})})})]},e.__rowId)}))}),(0,N.jsx)(v.A,{children:(0,N.jsx)(x.A,{children:(0,N.jsx)(m.A,{colSpan:5,children:(0,N.jsxs)(r.A,{onClick:Q,children:[(0,N.jsx)(j.A,{}),n?"\u6dfb\u52a0":"Add"]})})})})]})})]}),(0,N.jsxs)(l.Ay,{item:!0,xs:12,children:[n?"\u603b\u989d":"Total price",":",O.items.filter((e=>void 0!==e.productId&&"number"==typeof e.quantity)).map((e=>z.get(e.productId).price*e.quantity)).reduce(((e,n)=>e+n),0)]}),(0,N.jsx)(l.Ay,{item:!0,xs:12,children:(0,N.jsx)(r.A,{variant:"contained",onClick:Y,children:n?"\u63d0\u4ea4":"Submit"})})]})}),(0,N.jsxs)(k.A,{open:H,onClose:Z,children:[(0,N.jsx)(S.A,{children:n?"\u4fe1\u606f":"Info"}),(0,N.jsx)(y.A,{children:(0,N.jsx)(C.A,{children:n?"\u4ec5\u4f5c\u793a\u8303\uff0c\u65e0\u4efb\u4f55\u6548\u679c":"For demonstration only, without any effect"})}),(0,N.jsx)(b.A,{children:(0,N.jsx)(r.A,{onClick:Z,children:n?"\u5173\u95ed":"Close"})})]})]})})),q=[{id:1,nickName:"\u76ae\u76ae\u9c81",province:"\u56db\u5ddd",city:"\u6210\u90fd",address:"\u9f99\u6cc9\u9a7f\u533a\u6d2a\u7389\u8def\u4e0e\u5341\u6d2a\u8def\u4ea4\u53c9\u53e3"},{id:2,nickName:"\u9c81\u897f\u897f",province:"\u5e7f\u4e1c",city:"\u5e7f\u5dde",address:"\u767d\u4e91\u533a\u77f3\u6c99\u8def300\u53f7"},{id:3,nickName:"\u8212\u514b",province:"\u897f\u85cf",city:"\u62c9\u8428",address:"\u5806\u9f99\u5fb7\u5e86\u533a"},{id:4,nickName:"\u8d1d\u5854",province:"\u4e0a\u6d77",city:"\u4e0a\u6d77",address:"\u6d66\u4e1c\u65b0\u533a\u79c0\u6cbf\u897f\u8def218\u5f04"}],L=[{id:1,nickName:"Schneewittchen",province:"Berlin",city:"Prenzlauer Berg",address:"Brandenburgische Stra\xdfe 9, Prenzlauer Berg, Berlin, Germany"},{id:2,nickName:"Cinderella",province:"Basse-Normandie",city:"Lisieux",address:"20 rue L\xe9on Dierx, Lisieux, Basse-Normandie, France"},{id:3,nickName:"Nuwa",province:"ShanXi",city:"Taiyuan",address:"Qian Feng Nan Lu 99hao, Taiyuan, ShanXi, China"},{id:4,nickName:"Pinocchio",province:"Palazzo Pignano",city:"Cremona",address:"Via Giovanni Amendola 134, Palazzo Pignano, Cremona, Italy"}],P=[{id:1,name:"zippo\u591c\u5149\u6d41\u6c99\u6253\u706b\u673a",price:268},{id:2,name:"\u6770\u767b(Jayden)\u5370\u5ea6\u5854\u5e03\u62c9\u9f13",price:9238},{id:3,name:"\u6d6a\u7434(Longines)\u673a\u68b0\u624b\u8868",price:13900},{id:4,name:"viney\u7537\u58eb\u76ae\u5e26",price:139},{id:5,name:"\u96c5\u8bd7\u5170\u9edb\u7ed2\u96fe\u54d1\u5149\u5507\u818f",price:310},{id:6,name:"CIRCUIT\u7537\u5b50\u6ed1\u96ea\u5355\u677f",price:2044},{id:7,name:"\u7279\u4ed1\u82cf\u8131\u8102\u725b\u5976",price:47},{id:8,name:"\u4e50\u9ad8\u79ef\u6728\u5e03\u52a0\u8fea",price:374},{id:9,name:"\u53cc\u559c\u71c3\u6c14\u7535\u78c1\u901a\u7528\u538b\u529b\u9505",price:137},{id:10,name:"\u61a8\u61a8\u5ba0\u732b\u722c\u67b6",price:238}],T=[{id:1,name:"Timeless Vitamin C Plus E 10 Percent Ferulic Acid Serum Serum Unisex 1 oz",price:14.69},{id:2,name:"Dockers Men's Tiller Boat Shoe",price:52.41},{id:3,name:"Paxcoo 124 Skeins Embroidery Floss Cross Stitch Thread with Needles",price:29.99},{id:4,name:"Michael Kors Crossbody",price:70.6},{id:5,name:"Crocs unisex-child Classic Graphic Clog",price:34.99},{id:6,name:"Timex Time Machines Digital 35mm Watch",price:28.95},{id:7,name:"Scalex Mite & Lice Spray for Birds, 8 oz.",price:14.75},{id:8,name:"Under Armour Men's Storm Liner",price:13.03},{id:9,name:"Nike Women's Pro 3\" Training Shorts",price:35.86},{id:10,name:"Olaplex No. 4 Bond Maintenance Shampoo",price:30}];function W(e){const n=e.items,i=new Map;for(let t=0;t<n.length;t++){const e=n[t];if("number"!=typeof e.quantity)e.quantity=1;else if(e.quantity<1){n.splice(t--,1);continue}if(void 0===e.productId)continue;const o=i.get(e.productId);void 0===o?i.set(e.productId,e):(o.quantity+=e.quantity,n.splice(t--,1))}}},16712:(e,n,i)=>{i.d(n,{o:()=>o});var t=i(44586);function o(){const{i18n:e}=(0,t.A)(),n=e.currentLocale;return"zh"===n||"zh_cn"===n||"zh_CN"==n}},28453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>a});var t=i(96540);const o={},r=t.createContext(o);function s(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);